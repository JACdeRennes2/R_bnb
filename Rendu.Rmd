---
title: "R_bnb"
author: Clément PEREON, Anatole GAYANT, Jules AVIGNON
output: 
  html_document:
    theme: cosmo
    highlight: espresso
---

## Descritption de notre sujet

Notre projet porte sur la représentation des Airbnb au sein de grandes villes européennes, plus particulièrement sur le prix de location des biens imobiliers renseignés sur l'application.</br>
Notre travail comporte deux parties. Dans la première, nous tenterons d'expliquer les différences de prix entre les logements et, dans la deuxième, nous nous intéresserons à la représentation graphique de la répartition des biens.

Nos données proviennent du site kaggle : https://www.kaggle.com/datasets/thedevastator/airbnb-prices-in-european-cities

Nous disposons du prix des locations la semaine et le week-end pour 10 villes européennes.

## Quels sont les facteurs qui permettent d'expliquer la différence de prix entre deux biens?

```{r, include=FALSE}
# Importation des données
data_R_bnb <- na.omit(read.csv("data/data_rmd_R_bnb.csv", stringsAsFactors = TRUE, row.names = 1))
```

### Premières analyses

```{r, fig.align='center', echo=FALSE}
library(knitr)

# Prix moyen des Airbnb en semaine 
prix_moyen_semaine <- round(mean(data_R_bnb$prix_semaine), digits = 2)

# Prix moyen des aibrnbs le week-end
prix_moyen_week_end <- round(mean(data_R_bnb$prix_weekend), 2)

# Création d'un data.frame pour afficher les résultats
resultats <- data.frame(prix_moyen = c(prix_moyen_semaine, prix_moyen_week_end),période = c("Semaine", "Weekend"))

# Affichage des résultats à l'aide du package knitr
kable(resultats, format = "markdown", align = "c", caption = "Prix moyens des Airbnb selon la période")
```

```{r, include=FALSE}
rm(prix_moyen_semaine,prix_moyen_week_end)
```

```{r, fig.align='center', echo=FALSE}
library(ggplot2)
library(tidyr)

data <- data.frame(
  semaine = data_R_bnb$prix_semaine,
  weekend = data_R_bnb$prix_weekend
)

data_long <- gather(data, key = "prix", value = "valeur")

ggplot(data_long, aes(x = prix, y = valeur)) +
  geom_boxplot() +
  facet_grid(. ~ prix, scales = "free_x")+ 
    coord_cartesian(ylim = c(35, 500))+
    xlab("moment de la semaine")
```

```{r, include=FALSE}
rm(data, data_long)
```

Il est clair que les Airbnb sont plus chers le week-end. On cherche alors à quantifier l'influence de plusieurs variables explicatives sur le prix des Airbnb. Plus précisément, nous cherchons les variables qui permettent d'expliquer les différences de prix entre la semaine et le week-end.</br>
Nous avons fait le choix de limiter la taille de l'échantillon car, dans la base de données, il y a une trentaine de logements dont le coût de location dépasse les 8 000€, ce qui compromet la comparaison.

Nous allons à présent modéliser le prix des logements en fonction des variables suivantes: 

* room_type : facteur à 3 modalités (appartement privé, chambre partagé, chambre privée)
* person_capacity : nombre de personnes pouvant loger dans l'appartement
* host_is_superhost : variable binaire (vaut 1 si le propriétaire à été reconnu comme quelqu'un de confiance par les utilisateurs)
* cleanliness_rating : note de propreté sur 10 
* guest_satsifaction_overall : note de satsifaction des utilisateurs sur 100
* bedrooms : nombre de chambres
* metro_dist : distance au métro
* dist : distance au centre de la ville

```{r, include=FALSE}
library(plotly)
```

```{r, fig.align='center', echo=FALSE}
p <- ggplot(data_R_bnb, aes(x = prix_weekend, y = prix_semaine)) +
     geom_point(aes(color = room_type), size = 2.5) +
     theme_classic() +
     xlab("Prix weekend") +
     ylab("Prix semaine") +
     labs(color = "Type de chambre") +
     scale_color_manual(values = c("#FA8072", "#20B2AA", "#1E90FF"))
ggplotly(p)
```

Les maisons et les appartements privés sont logiquement plus chers que les chambres privées et les chambres partagées. En général, plus un bien est cher en semaine, plus il sera cher le week-end.</br>
On observe que plusieurs logements ne proposent pas de location le week-end.

### Analyse des corrélations

```{r, include=FALSE}
library(corrplot)
```

```{r, fig.align='center', echo=FALSE}
variables_semaine <- data_R_bnb[,c("prix_semaine", "person_capacity", "cleanliness_rating","guest_satisfaction_overall","bedrooms", "metro_dist", "dist")]
varaibles_weekend <- data_R_bnb[,c("prix_weekend", "person_capacity", "cleanliness_rating","guest_satisfaction_overall","bedrooms", "metro_dist", "dist")]

cor_semaine <- cor(variables_semaine)
cor_weekend <- cor(varaibles_weekend)

layout(matrix(c(1,2), nrow=1, ncol=2))

corrplot(cor_semaine, method = c("shade"), type = "lower",order="hclust", tl.col="black")
corrplot(cor_weekend, method = c("shade"), type = "lower",order="hclust", tl.col="black")
rm(cor_semaine,cor_weekend)
```

D'après les matrices de corrélation, il n'y a pas de différence significative entre les corrélations des variables la semaine et le week-end.

### Régressions linéaires

```{r, echo=FALSE}
# Regression semaine
reg_semaine <-  lm(prix_semaine~room_type+person_capacity+host_is_superhost+cleanliness_rating+bedrooms+guest_satisfaction_overall+metro_dist+dist, data = data_R_bnb)
tbl_semaine <- kable(summary(reg_semaine)$coefficients, caption = "Résumé de la régression linéaire pour la semaine", border = "solid")

# Regression week-end
reg_weekend <-  lm(prix_weekend~room_type+person_capacity+host_is_superhost+cleanliness_rating+guest_satisfaction_overall+bedrooms+metro_dist+dist, data = data_R_bnb)
tbl_weekend <- kable(summary(reg_weekend)$coefficients, caption = "Résumé de la régression linéaire pour le week-end", border = "solid")

# Résumé de la régression linéaire pour le premier jeu de données
tbl_semaine

# Résumé de la régression linéaire pour le deuxième jeu de données
tbl_weekend
```

Le type de chambre, la confiance qu'ont les utilisateurs envers le propriétaire, le nombre de chambres, la distance au métro et la distance au centre ville expliquent de manière significative, au niveau 0.1%, le prix du logements la semaine. On fait le même constat pour le week-end et on observe également que le nombre de personnes pouvant loger dans l'appartement est une variable significative au niveau 10%. On peut penser que les familles et les groupes d'amis ont plutôt tendance à réserver des logements le week-end.

### Zoom sur le type de logement et la confiance envers le propriétaire 

On souhaite déterminer si le prix moyen des logements diffère selon les différentes modalités des variables room_type et host_is_superhost.  

```{r, fig.align='center', echo=FALSE}
ggplot(data_R_bnb, aes(x=room_type, y=prix_semaine, fill=host_is_superhost)) +
  geom_boxplot() +
  labs(x="Type de logement", y="Prix/semaine", fill="Hôte de confiance") +
  theme_classic()+
    coord_cartesian(ylim = c(35, 500))+ggtitle("Boxplot du prix des logements en semaine selon leur type")

ggplot(data_R_bnb, aes(x=room_type, y=prix_weekend, fill=host_is_superhost)) +
  geom_boxplot() +
  labs(x="Type de logement", y="Prix/weekend", fill="Hôte de confiance") +
  theme_classic()+
    coord_cartesian(ylim = c(35, 500))+ggtitle("Boxplot du prix des logements le week-end selon leur type")
```

On observe une légère différence de prix pour les maisons et les appartements privés selon que le propriétaire ait été reconnu comme quelqu'un de confiance par les utilisateurs ou pas. Quelque soit la période, ces biens ont tendance a être moins chers lorsque le propriétaire a été reconnu comme une personne de confiance.

### Conclusion 

Aucune caractéristique ne semble plus importante que les autres quand il s'agit d'expliquer la différence de prix des Airbnb entre la semaine et le weekend.</br>
On peut néanmoins noter que le week-end est généralement un moment où les utilisateurs ont plus de temps libre et peuvent voyager, ce qui entraîne une augmentation de la demande des Airbnb et donc une augmentation des prix.</br>
De plus, les hôtes Airbnb peuvent réduire leur disponibilité le week-end pour des raisons personnelles, ce qui peut réduire l'offre de locations disponibles et augmenter les prix en raison de la concurrence accrue pour les locations restantes.</br>
Enfin, les voyageurs ont souvent tendance à réserver des séjour plus longs le week-end, ce qui peut augmenter le prix moyen de la nuitée en raison de la réuction de la disponibilité des logements à court terme.

## Application R Shiny

Pour illustrer nos données, nous avons réalisé une application sur R Shiny présentant sur une première page une carte intéractive réalisée avec le package leaflet.</br>
Nous avons fait un zoom sur l'Europe occidentale et nous avons représenté les clusters des locations disponibles sur Airbnb dans les 10 villes de notre base de données.</br>
Les pays sont colorés en fonction du prix moyen des locations et chaque bien est coloré en fonction de son prix.</br>
Nous avons ajouté un filtre permettant de zoomer sur la ville du pays sélectionné, un bouton pour choisir la période, ainsi qu'une barre de pricing permettant de sélectionner une fourchette de prix.</br>
Nous avons également ajouté un histogramme représentant la répartition des Airbnb en fonction du prix. L'histogramme s'adapte à la sélection.</br>
Sur une deuxième page, nous avons fait figurer un ensemble de graphes présentant des statistiques descriptives diverses et variées sur les variables.








