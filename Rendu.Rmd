---
title: "R_bnb"
output: 
  html_document:
    theme: cosmo
    highlight: espresso
---

# Quels sont les facteurs qui permettent d'expliquer la différence de prix entre 2 biens?

les données proviennet du site kaggle : https://www.kaggle.com/datasets/thedevastator/airbnb-prices-in-european-cities

```{r, include=FALSE}
#Importation des données
data_R_bnb <- na.omit(read.csv("data/data_rmd_R_bnb.csv", stringsAsFactors = TRUE, row.names = 1))
```

Les donnés donnent le détails des prix des Airbnb en fonction de plusieurs variables et du moment de la semaine. Ainsi on peut voir que les prix moyen des airbnb n'est pas le même la semaine et le weekend

```{r, fig.align='center', echo=FALSE}
library(knitr)
#prix moyen des airbnb la semaine 
prix_moyen_semaine <- round(mean(data_R_bnb$prix_semaine), digits = 2 )
#prix moyen des aibrnb le weekend
prix_moyen_week_end <- round(mean(data_R_bnb$prix_weekend), 2)

# Création d'une data.frame pour afficher les résultats
resultats <- data.frame(Prix_moyen = c(prix_moyen_semaine, prix_moyen_week_end),Période = c("Semaine", "Weekend"))

# Affichage des résultats avec le package knitr
kable(resultats, format = "markdown", align = "c", caption = "Prix moyens des Airbnb par période")
```

```{r, include=FALSE}
rm(prix_moyen_semaine,prix_moyen_week_end)
```

On cherche à quantifier l'influence de plusieurs variables explicatives sur le prix des Airbnb. Et plus précisément qu'elles sont celles qui permettent d'expliquer une différence de prix entre la semaine et le weekend. 
En effet, on observe une différence de prix des biens entre la semaine et le weekend. Cependant on peut observer que cette différence de prix entre la semaine et le week-end n'est pas la même pour tous les biens. Comme le montre le graphique suivant 



```{r, fig.align='center'}
# Chargement des packages nécessaires
library(ggplot2)
library(tidyr)

# Exemple de données
data <- data.frame(
  semaine = data_R_bnb$prix_semaine,
  weekend = data_R_bnb$prix_weekend
)

# Transformation des données en format long
data_long <- gather(data, key = "prix", value = "valeur")

# Création du boxplot en facettes
ggplot(data_long, aes(x = prix, y = valeur)) +
  geom_boxplot() +
  facet_grid(. ~ prix, scales = "free_x")+ 
    coord_cartesian(ylim = c(35, 500))+
    xlab("moment de la semaine")
```


```{r, include=FALSE    }
rm(data, data_long)
```

Sur le Graphique précédent il est clair que les Airbnb sont plus cher le weekend que la semaine. On peut remarquer cependant que la hausse des prix n'est pas exactement partout la même. (Il semblerait que plus le logement est cher la semaine plus ce dernier est cher le weekend). Nous avons fait le choix de limiter la taille du graphique car dans la base de données il existe une trentaine de logements qui sont a plus de 8 000€. Ces données empêchent donc toute représentation du jeu de données. 

```{r, fig.align='center', include=FALSE}
library(plotly)
library(dplyr)
```


```{r, fig.align='center'}
p <- ggplot(data_R_bnb, aes(x = prix_weekend, y = prix_semaine)) +
     geom_point(aes(color = room_type), size = 2.5) +
     theme_classic() +
     xlab("Prix weekend") +
     ylab("Prix semaine") +
     labs(color = "Type de chambre") +
     scale_color_manual(values = c("#FA8072", "#20B2AA", "#1E90FF"))
ggplotly(p)
```


Nous allons tenter de modéliser le prix des logements par les variables suivantes: 

* room_type : facteur à 3 modalités (appartement privé, chambre partagé, chambre privée)
* person_capacity : Nombre de personnes pouvant loger dans l'appartement
* host_is_superhost : Variable binaire (1 si Propriétaire à été reconnu comme quelqu'un de confiance par les utilisateurs)
* cleanliness_rating : note de propreté sur 10 
* guest_satsifaction_overall : note de satsifaction des utilisateurs sur 100
* bedrooms : nombre de chambre
* metro_dist : distance au métro
* dist : distance au centre de la ville


# Analyse de corrélation 

```{r, fig.align='center'}
library(corrplot)
# Création de variables intermédiaire
variables_num1 <- data_R_bnb[,c("prix_semaine", "person_capacity", "cleanliness_rating","guest_satisfaction_overall","bedrooms", "metro_dist", "dist")]
Varaibles_num2 <- data_R_bnb[,c("prix_weekend", "person_capacity", "cleanliness_rating","guest_satisfaction_overall","bedrooms", "metro_dist", "dist")]

cor_data1 <- cor(variables_num1)
cor_data2 <- cor(Varaibles_num2)
# Définition des paramètres graphiques
layout(matrix(c(1,2), nrow=1, ncol=2))

# Tracage des graphiques 
corrplot(cor_data1, method = c("shade"), type = "lower",order="hclust", tl.col="black")
corrplot(cor_data2, method = c("shade"), type = "lower",order="hclust", tl.col="black")
rm(cor_data1,cor_data2)
```

A la vue du graphique précédent, on n'observe pas de différence significative entre la corrélation des variables la semaine et le weekends.

# Anova 

On peut réaliser une analyse de variance (ANOVA) pour déterminer si le prix moyen des logements diffère significativement entre les différentes catégories de room_type ou de host_is_superhost   

```{r, fig.align='center'}
ggplot(data_R_bnb, aes(x=room_type, y=prix_semaine, fill=host_is_superhost)) +
  geom_boxplot() +
  labs(x="Type de chambre", y="Prix/semaine", fill="Hôte de confiance") +
  theme_classic()+
    coord_cartesian(ylim = c(35, 500))+ggtitle("Boxplot des prix des chambres en semaine selon les modalités des chambres")

ggplot(data_R_bnb, aes(x=room_type, y=prix_weekend, fill=host_is_superhost)) +
  geom_boxplot() +
  labs(x="Type de chambre", y="Prix/weekend", fill="Hôte de confiance") +
  theme_classic()+
    coord_cartesian(ylim = c(35, 500))+ggtitle("Boxplot des prix des chambres le weekend selon les modalités des chambres")
```

On remarque que les maison et les appartement entiers dont le propriétaires n'est pas super host ont tendances à être plus cher que ceux dont le propriétaire est super host. Ce qui semble déconcertant. On remaque que les chambres privés semblent ne pas suivre la même loi, puisque les prix sont les quasi les mêmes pour les 2. 


## Analyse de variance pour les prix de la semaine
```{r}
library(knitr)
library(broom)
anova_result <- aov(prix_semaine ~ room_type + host_is_superhost, data=data_R_bnb)
anova_summary <- tidy(anova_result)
kable(anova_summary, digits = 2, caption = "Résultats de l'ANOVA pour les prix de la semaine")

tukey_result <- TukeyHSD(anova_result, "room_type")
tukey_summary <- as.data.frame(tukey_result$`room_type`)
kable(tukey_summary, digits = 2, caption = "Comparaison multiple de Tukey pour les prix de la semaine")

```

## Analyse de variance pour les prix du week-end
```{r}

## Analyse de variance pour les prix du week-end
anova_result <- aov(prix_weekend ~ room_type + host_is_superhost, data=data_R_bnb)
anova_summary <- tidy(anova_result)
kable(anova_summary, digits = 2, caption = "Résultats de l'ANOVA pour les prix du week-end")

tukey_result <- TukeyHSD(anova_result, "room_type")
tukey_summary <- as.data.frame(tukey_result$`room_type`)
kable(tukey_summary, digits = 2, caption = "Comparaison multiple de Tukey pour les prix du week-end")
```


# Régression linéaire
```{r}

#regression semaine
reg1 <-  lm(prix_semaine~room_type+person_capacity+host_is_superhost+cleanliness_rating+bedrooms+guest_satisfaction_overall+metro_dist+dist, data = data_R_bnb)
tbl1 <- kable(summary(reg1)$coefficients, caption = "Résumé de la régression linéaire pour la semaine", border = "solid")

# reg lin weekend
reg2 <-  lm(prix_weekend~room_type+person_capacity+host_is_superhost+cleanliness_rating+guest_satisfaction_overall+bedrooms+metro_dist+dist, data = data_R_bnb)
tbl2 <- kable(summary(reg2)$coefficients, caption = "Résumé de la régression linéaire pour le weekends", border = "solid")

### Résumé de la régression linéaire pour le premier jeu de données
tbl1

### Résumé de la régression linéaire pour le deuxième jeu de données
tbl2
```


# Conclusion 

Aucune caractéristique ne semblent plus importante que les autres quand il s'agit d'expliquer la différence de prix des Airbnb entre la semaine et le weekend. 
